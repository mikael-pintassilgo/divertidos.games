{% extends 'base.html' %}

{% block content %}
<form action="{{ url_for('game_elements.create') }}" method="post">
  <fieldset class="">

    <legend class="">New Game Element</legend>
    
    <label for="type_of_id" class="form-label">Type of ID</label>
    <select class="form-select mb-3" aria-label="Type of element ID" name="type_of_id" id="type_of_id" required>
      <option selected value="element">Element</option>
      <option value="game_element">Game element</option>
    </select>
    
    <label for="previous_ge_id" class="form-label">Previous Game Element ID</label>
    <input class="form-control mb-3" placeholder="previous_ge_id" name="previous_ge_id" id="previous_ge_id" value="{{ request.form['previous_ge_id'] }}">
    <label for="parent_element_id" class="form-label">Parent Game Element ID</label>
    <input class="form-control mb-3" placeholder="parent_ge_id" name="parent_element_id" id="parent_element_id" value="{{ parent_element_id or request.form['parent_element_id'] }}">
    
    <label for="element_id" class="form-label">Element or Game Element ID</label>
    
    <div class="input-group mb-3">
      <input class="form-control mb-3" placeholder="element_id or ge_id" name="element_id" id="element_id" value="{{ request.form['element_id'] }}" aria-describedby="selectElementBtn" required>
  
      <button type="button" class="btn btn-outline-secondary mb-3" id="selectElementBtn" data-bs-toggle="offcanvas" data-bs-target="#elementPanel">
        Select
      </button>
    </div>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="elementPanel" aria-labelledby="elementPanelLabel">
      <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="elementPanelLabel">Select an Element</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body p-0">
      <div class="list-group list-group-flush" id="elementsList">
        <p class="p-3">Loading...</p>
      </div>
      </div>
    </div>

    <script>
    document.getElementById('selectElementBtn').addEventListener('click', function() {
      fetch('{{ url_for("blog.get_elements_for_selection") }}')
      .then(response => response.json())
      .then(data => {
        const elementsList = document.getElementById('elementsList');
        elementsList.innerHTML = '';
        data.elements.forEach(element => {
        const button = document.createElement('button');
        button.type = 'button';
        button.className = 'list-group-item list-group-item-action text-start p-3';
        button.innerHTML = `<h6 class="mb-1">${element.title}</h6><p class="mb-1 small text-muted">${element.body.substring(0, 100)}</p>`;
        button.onclick = () => selectElement(element.id);
        elementsList.appendChild(button);
        });
      });
    });

    function selectElement(elementId) {
      document.getElementById('element_id').value = elementId;
      bootstrap.Offcanvas.getInstance(document.getElementById('elementPanel')).hide();
    }
    </script>
    
    <input class="form-control mb-3" placeholder="weight" name="ge_weight" id="ge_weight" value="{{ request.form['ge_weight'] }}">
    <input class="form-control mb-3" placeholder="link" name="ge_link" id="ge_link" value="{{ request.form['ge_link'] }}">
    <input class="form-control mb-3" placeholder="description" name="description" id="description" value="{{ request.form['description'] }}">

    <input class="form-control mb-3" name="game_id" id="games_id" value="{{ request.args.get('game_id') }}">                

    <input class="btn btn-primary" type="submit" value="Add Element">
    
  </fieldset>
</form>
{% endblock %}
