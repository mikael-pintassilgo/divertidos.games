{% extends 'base.html' %}

{% block breadcrumb %}
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{{ url_for('games.index') }}">Games</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{ game['title'] }}</li>
  </ol>
</nav>
{% endblock %}

{% block header %}
  
{% endblock %}

{% block content %}
<div class='row mt-3'>
  <div class='col-12'>
  
    <div class="card" style="">
      <div class="card-header">Game Details</div>
      <div class="card-body">
        <h5 class="card-title">{{ game['title'] }}
        </h5>
        
        <div name="body" id="body">
          <p class="fs-4">{{ request.form['body'] or game['body'] }}</p>
        </div>
        
        <br/>
        <div class= "text-body-secondary" name="comment" id="comment">
          <p class="fs-4">{{ request.form['comment'] or game['comment'] }}</p>
        </div>
  
      </div>
      <div class="card-body">
        {% if g.user['id'] == game['author_id'] %}
        <a class="card-link" aria-current="page" href="{{ url_for('games.update', id=game['id']) }}">edit</a>
        <a class="card-link" href="{{ url_for('games.get_full_description', id=game['id']) }}">get full description</a>
        {% else %}
        <a class="card-link" href="{{ url_for('games.get_full_description', id=game['id']) }}">get full description</a>
        {% endif %}  
      </div>

    </div>
  
  </div>
</div>
    
<div class='row mt-3'>
  <div class='col-12'>

    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Elements</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">Links</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact-tab-pane" type="button" role="tab" aria-controls="contact-tab-pane" aria-selected="false">Tags</button>
      </li>
    </ul>
    
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
        {% if parent_id != None and parent_id != '' %}
          <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="{{ url_for('games.view', id=game['id']) }}">Top elements</a></li>
              {% for parent in game_elements_parents %}
                {% if loop.last %}
                <li class="breadcrumb-item active" aria-current="page">{{ parent.description }}</li>
                {% else %}
                <li class="breadcrumb-item"><a href="{{ url_for('games.view', id=game['id'], parent_id=parent.id) }}">{{ parent.description }}</a></li>
                {% endif %}
              {% endfor %}
              <!-- <li class="breadcrumb-item active" aria-current="page">{{ parent }}</li> -->
            </ol>
          </nav>
        {% endif %}
        
        <table class="table table-hover">
          <tbody>
            <thead>
              <tr>
                <th scope="col">Title</th>
                <th scope="col">Description</th>
                <th scope="col">Consist</th>
                <th scope="col">More...</th>          
              </tr>
            </thead>
            
            {% macro render_elements(elements, level=0) %}
              {% for element in elements %}
                <tr>
                  <td style="padding-left: {{ level * 20 }}px;">
                    <p><a href="{{ url_for('blog.view', id=element['e_id']) }}">{{ element['title'] }}</a></p>
                  </td>
                  <td style="padding-left: {{ level * 20 }}px;">
                    <p>{{ element['description'] }}</p>
                  </td>
                  <td>
                    {% if element['consist_count'] == 1 %}
                      <p><a href="{{ url_for('games.view', id=game['id'], parent_id=element['ge_id']) }}">1 element</a></p>
                    {% elif element['consist_count'] > 1 %}
                      <p><a href="{{ url_for('games.view', id=game['id'], parent_id=element['ge_id']) }}">{{ element['consist_count'] }} elements</a></p>
                    {% else %}
                      <p></p>
                    {% endif %}
                  </td>
                  <td>
                    <a class="btn btn-primary btn-sm" href="{{ url_for('game_elements.view', ge_id=element['ge_id'], game_id=game['id']) }}">more...</a>
                  </td>
                </tr>
                {% if element.children %}
                  {{ render_elements(element.children, level + 1) }}
                {% endif %}
              {% endfor %}
            {% endmacro %}
            {{ render_elements(game_elements_tree) }}
            <!--
            {% for game_element in game_elements %}
              {% if (game_element['parent_element_id'] == None or game_element['parent_element_id'] == '') or parent_id|string == game_element['parent_element_id']|string %}
                <tr>
                    <td>
                      {% if game_element['previous_ge_description'] is not none %}
                      <p>{{ game_element['previous_ge_description'] }}</p>
                      {% endif %}
                    </td>
                    <td>
                      <p><a href="{{ url_for('blog.view', id=game_element['e_id']) }}">{{ game_element['title'] }}</a></p>
                    </td>
                    <td>
                      <p>{{ game_element['description'] }}</p>
                    </td>
                    
                    <td>
                      {% if game_element['consist_count'] == 1 %}
                      <p><a href="{{ url_for('games.view', id=game['id'], parent_id=game_element['ge_id']) }}">1 element</a></p>
                      {% elif game_element['consist_count'] > 1 %}
                      <p><a href="{{ url_for('games.view', id=game['id'], parent_id=game_element['ge_id']) }}">{{ game_element['consist_count'] }} elements</a></p>
                      {% else %}
                      <p/>
                      {% endif %}
                      
                    </td>
                    <td class="">
                      <a class="btn btn-primary btn-sm" href="{{ url_for('game_elements.view', ge_id=game_element['ge_id'], game_id=game['id']) }}">more...</a>
                    </td>
                    
                </tr>
              {% endif %}
            {% endfor %}
            -->
          </tbody>
          
        </table>
      </div>

      <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
        <table class="table table-hover">
          <caption class="caption-top">Links</caption>
          <tbody>
            <thead>
              <tr>
                <th scope="col">link</th>
                <th scope="col">comment</th>
              </tr>
            </thead>
            {% for link in links %}
              <tr>
                  <td>
                    <p><a href="{{ link['title'] }}" target="_blank">{{ link['title'] }}</a></p>
                  </td>
                  <td>
                    {% if link['comment'] == None %}
                    <p></p>
                    {% else %}
                    <p>{{ link['comment'] }}</p>
                    {% endif %}
                  </td>
              </tr>
              {% if loop.last %}
              {% endif %}
            {% endfor %}
      </div>

      <div class="tab-pane fade" id="contact-tab-pane" role="tabpanel" aria-labelledby="contact-tab" tabindex="0">
        {% for tag in tags %}
            <article class="">
              <header>
                <div>
                  <a href="#" onclick="tagOnClick('{{ tag['title'] }}')">
                    <p class="fs-4">#{{ tag['title'] }}</p>
                  </a>
                </div>
              </header>
            </article>
          {% endfor %}
      </div>
    </div>

  </div>
</div>

<script>
  /*el = document.getElementById("body");
  el.innerHTML = "{{ (request.form['body'] or game['body']) }}";
  console.log("{{ (request.form['body'] or game['body']) }}");*/
</script>

{% endblock %}
