{% extends 'base.html' %}

{% block header %}
  <div uk-grid class="">
    <h1 class="">{% block title %}Games{% endblock %}</h1>
    {% if g.user %}
    <a class="" href="{{ url_for('games.create') }}">add game</a>
    {% endif %}
  </div>
{% endblock %}

<div class="uk-container-expand"></div>
{% block menu_items %}
{% endblock %}
{% block games_active %}active{% endblock %}

{% block content %}
  
<div class='row mb-2 mt-2'>
  <div class='col'>
    {% for tag in tags %}
    <span class="badge text-bg-secondary">
      #{{ tag }}
      <button type="button" class="btn-close" aria-label="Close" onclick="tagCloseOnClickGeneral('{{ tag }}')"></button>
    </span>
    {% endfor %}
  </div>
</div>

<div class="row row-cols-auto">
{% for game in games %}
  <div class="col">
    <div class="card mb-2" style="width: 18rem;">
      <!-- img src="..." class="card-img-top" alt="..." -->
      <div class="card-body">
        <h5 class="card-title"><a class="" href="{{ url_for('games.view', id=game['id']) }}">{{ game['title'] }}</a></h5>
        <p class="card-text">{{ game['body'] }}</p>
      </div>
      <ul class="list-group list-group-flush">
        <li class="list-group-item">by {{ game['username'] }} on {{ game['created'].strftime('%Y-%m-%d') }}</li>
      </ul>
      
      {% if game["tags"] != None and game["tags"] != "" %}
      <div class="card-body">
        {% for tag in game["tags"].split(';') %}
          {% if tag != '' %}  
            <!-- a href="{{ url_for('index') + '?tag=' + tag }}" onclick='tagOnClick()'>{{ tag }}</a -->
            <a href="#" onclick="tagOnClickGeneral('{{ tag }}')">#{{ tag }}</a>
          {% endif %}
        {% endfor %}
      </div>
      {% endif %}
      
      {% if g.user['id'] == game['author_id'] %}
      <div class="card-body">
        <a class="" href="{{ url_for('games.update', id=game['id']) }}">edit</a>
      </div>
      {% endif %}
    </div>
  </div>
{% endfor %}
</div>

<div class='row mt-2'>
  <nav aria-label="Pagination">
    <ul class="pagination">
      {% if currentPage > 1 %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index') + '?page='+(currentPage-1)|string }}">Previous</a></li>
      {% else %}
      {% endif %}
      <li class="page-item"><a class="page-link" href="{{ url_for('index') + '?page='+(currentPage+1)|string }}">Next</a></li>
    </ul>
  </nav>
</div>

<script>
  function tagOnClick(tag_title) {
    tags = getCookie('tags');
    if (tags == null) {
      tags = ""
    }
    if (tags.length > 0 && tags.search(tag_title) == -1) {
      setCookie('tags', tags + '%%' + tag_title, 0)
    } else if (tags.length == 0) {
      setCookie('tags', tag_title, 0)
    }
    window.location.href = "{{ url_for('index') }}" + "?tag=" + tag_title;
  }
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C7QR1MW3WC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C7QR1MW3WC');
</script>
{% endblock %}

